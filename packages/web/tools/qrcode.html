<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>二维码生成 - 拾光工具箱</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/tool.css">
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
  <style>
    .qr-preview {
      background: #fff;
      border-radius: var(--radius-md);
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 200px;
      border: 1px solid var(--border);
    }
    .qr-preview img {
      max-width: 100%;
      image-rendering: pixelated;
    }
    .qr-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 16px;
    }
    .qr-option label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    .qr-option select, .qr-option input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 14px;
    }
    @media (max-width: 600px) {
      .qr-options {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="container">
      <div class="nav-content">
        <a href="/" class="logo">
          <svg class="icon" viewBox="0 0 24 24"><path d="M20.083 15.2l1.202.721a.5.5 0 0 1 0 .858l-8.77 5.262a1 1 0 0 1-1.03 0l-8.77-5.262a.5.5 0 0 1 0-.858l1.202-.721L12 20.05l8.083-4.85zm0-4.7l1.202.721a.5.5 0 0 1 0 .858L12 17.65l-9.285-5.571a.5.5 0 0 1 0-.858l1.202-.721L12 15.35l8.083-4.85zm-7.569-9.191l8.771 5.262a.5.5 0 0 1 0 .858L12 13 2.715 7.429a.5.5 0 0 1 0-.858l8.77-5.262a1 1 0 0 1 1.03 0z"/></svg>
          <span>拾光工具箱</span>
        </a>
        <button id="themeToggle" class="theme-btn">
          <svg class="icon" viewBox="0 0 24 24"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7z"/></svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="tool-container">
    <div class="tool-header">
      <h1>
        <svg class="icon" viewBox="0 0 24 24"><path d="M16 17v-1h-3v-3h3v2h2v2h-1v2h-2v2h-2v-3h2v-1h1zm5 4h-4v-2h2v-2h2v4zM3 3h8v8H3V3zm2 2v4h4V5H5zm8-2h8v8h-8V3zm2 2v4h4V5h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5z"/></svg>
        二维码生成
      </h1>
      <p>生成自定义二维码</p>
    </div>

    <div class="tool-card">
      <div class="card-header">输入内容</div>
      <textarea id="input" class="code-input" placeholder="输入文字或网址" oninput="generate()">https://box.52eh.com</textarea>
      
      <div class="qr-options">
        <div class="qr-option">
          <label>尺寸</label>
          <select id="size" onchange="generate()">
            <option value="4">小 (132px)</option>
            <option value="6" selected>中 (198px)</option>
            <option value="8">大 (264px)</option>
            <option value="10">超大 (330px)</option>
          </select>
        </div>
        <div class="qr-option">
          <label>容错级别</label>
          <select id="errorLevel" onchange="generate()">
            <option value="L">L - 7%</option>
            <option value="M" selected>M - 15%</option>
            <option value="Q">Q - 25%</option>
            <option value="H">H - 30%</option>
          </select>
        </div>
      </div>
    </div>

    <div class="tool-card">
      <div class="card-header">
        <span>二维码预览</span>
        <button class="btn" onclick="download()">下载 PNG</button>
      </div>
      <div class="qr-preview" id="preview">
        <span style="color:var(--text-secondary)">输入内容后生成二维码</span>
      </div>
    </div>
  </div>

  <script src="/js/config.js"></script>
  <script>
    function generate() {
      const text = document.getElementById('input').value.trim();
      const preview = document.getElementById('preview');
      
      if (!text) {
        preview.innerHTML = '<span style="color:var(--text-secondary)">输入内容后生成二维码</span>';
        return;
      }

      const size = parseInt(document.getElementById('size').value);
      const errorLevel = document.getElementById('errorLevel').value;
      
      try {
        const qr = qrcode(0, errorLevel);
        qr.addData(text);
        qr.make();
        
        const img = qr.createDataURL(size, 0);
        preview.innerHTML = `<img src="${img}" alt="QR Code" id="qrImage">`;
      } catch (e) {
        preview.innerHTML = '<span style="color:#ef4444">内容过长，请减少字符</span>';
      }
    }

    function download() {
      const img = document.getElementById('qrImage');
      if (!img) {
        showToast('请先生成二维码');
        return;
      }

      const link = document.createElement('a');
      link.download = 'qrcode.png';
      link.href = img.src;
      link.click();
      showToast('下载成功');
    }

    function showToast(msg) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = msg;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }

    // 初始化
    generate();
  </script>
</body>
</html>
